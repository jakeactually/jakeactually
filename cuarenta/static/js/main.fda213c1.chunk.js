(this["webpackJsonpcuarenta-front"]=this["webpackJsonpcuarenta-front"]||[]).push([[0],{47:function(t,e,n){},48:function(t,e,n){},80:function(t,e,n){"use strict";n.r(e);var c={};n.r(c),n.d(c,"card_10C",(function(){return P})),n.d(c,"card_10D",(function(){return J})),n.d(c,"card_10H",(function(){return N})),n.d(c,"card_10S",(function(){return M})),n.d(c,"card_2C",(function(){return L})),n.d(c,"card_2D",(function(){return R})),n.d(c,"card_2H",(function(){return U})),n.d(c,"card_2S",(function(){return I})),n.d(c,"card_3C",(function(){return K})),n.d(c,"card_3D",(function(){return Q})),n.d(c,"card_3H",(function(){return F})),n.d(c,"card_3S",(function(){return z})),n.d(c,"card_4C",(function(){return q})),n.d(c,"card_4D",(function(){return B})),n.d(c,"card_4H",(function(){return G})),n.d(c,"card_4S",(function(){return W})),n.d(c,"card_5C",(function(){return Y})),n.d(c,"card_5D",(function(){return V})),n.d(c,"card_5H",(function(){return X})),n.d(c,"card_5S",(function(){return Z})),n.d(c,"card_6C",(function(){return $})),n.d(c,"card_6D",(function(){return tt})),n.d(c,"card_6H",(function(){return et})),n.d(c,"card_6S",(function(){return nt})),n.d(c,"card_7C",(function(){return ct})),n.d(c,"card_7D",(function(){return at})),n.d(c,"card_7H",(function(){return rt})),n.d(c,"card_7S",(function(){return it})),n.d(c,"card_8C",(function(){return st})),n.d(c,"card_8D",(function(){return ot})),n.d(c,"card_8H",(function(){return ut})),n.d(c,"card_8S",(function(){return dt})),n.d(c,"card_9C",(function(){return ft})),n.d(c,"card_9D",(function(){return lt})),n.d(c,"card_9H",(function(){return pt})),n.d(c,"card_9S",(function(){return mt})),n.d(c,"card_AC",(function(){return bt})),n.d(c,"card_AD",(function(){return ht})),n.d(c,"card_AH",(function(){return jt})),n.d(c,"card_AS",(function(){return vt})),n.d(c,"card_JC",(function(){return gt})),n.d(c,"card_JD",(function(){return Ot})),n.d(c,"card_JH",(function(){return _t})),n.d(c,"card_JS",(function(){return xt})),n.d(c,"card_KC",(function(){return St})),n.d(c,"card_KD",(function(){return yt})),n.d(c,"card_KH",(function(){return Ct})),n.d(c,"card_KS",(function(){return wt})),n.d(c,"card_QC",(function(){return Dt})),n.d(c,"card_QD",(function(){return kt})),n.d(c,"card_QH",(function(){return Tt})),n.d(c,"card_QS",(function(){return Ht}));var a=n(0),r=n.n(a),i=n(13),s=n.n(i),o=(n(47),n(48),n(15)),u=n(4),d=n(16),f=n(9),l=n.n(f),p=n(14),m=n(10),b=n(6),h=n.n(b),j=n(1),v=function(t){t.match;var e=Object(u.f)(),n=Object(a.useState)(""),c=Object(m.a)(n,2),r=c[0],i=c[1];return Object(a.useEffect)((function(){h.a.get("/").then((function(t){var e=t.data;i(e.name)}))}),[]),Object(j.jsx)("main",{children:Object(j.jsxs)("form",{children:[Object(j.jsx)("input",{type:"text",placeholder:"Enter a name",value:r,onChange:function(t){return i(t.target.value)},required:!0}),Object(j.jsx)("br",{}),Object(j.jsx)("button",{type:"button",className:"blue-button",onClick:g(e,r),children:"Make a room"})]})})},g=function(t,e){return Object(p.a)(l.a.mark((function n(){var c,a,r;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(c=new URLSearchParams).append("username",e),n.next=4,h.a.post("/new-room",c);case 4:a=n.sent,r=a.data,401===a.status?t.push("/join-room/".concat(r.room_id)):t.push("/room/".concat(r.room_id));case 8:case"end":return n.stop()}}),n)})))},O=n(27),_=n(28),x="join",S="leave",y="message",C=function(){return(new Date).getTime()},w=function(){function t(e,n){Object(O.a)(this,t),this.topic=e,this.socket=n,this.onMessageHandlers=[]}return Object(_.a)(t,[{key:"join",value:function(){this.socket.ws.send(JSON.stringify({event:x,topic:this.topic}))}},{key:"leave",value:function(){this.socket.ws.send(JSON.stringify({event:S,topic:this.topic}))}},{key:"handleMessage",value:function(t){this.onMessageHandlers.forEach((function(e){e.subject===t.subject&&e.callback(t.payload)}))}},{key:"on",value:function(t,e){this.onMessageHandlers.push({subject:t,callback:e})}},{key:"push",value:function(t,e){this.socket.ws.send(JSON.stringify({event:y,topic:this.topic,subject:t,payload:e}))}}]),t}(),D=function(){function t(e){Object(O.a)(this,t),this.endpoint=e,this.ws=null,this.channels=[],this.lastPing=C(),this.reconnectTries=0,this.attemptReconnect=!0}return Object(_.a)(t,[{key:"_connectionIsStale",value:function(){return t=this.lastPing,(C()-t)/1e3>100;var t}},{key:"_reconnect",value:function(){var t=this;clearTimeout(this.reconnectTimeout),this.reconnectTimeout=setTimeout((function(){t.reconnectTries++,t.connect(t.params),t._reconnect()}),this._reconnectInterval())}},{key:"_reconnectInterval",value:function(){return[1e3,2e3,5e3,1e4][this.reconnectTries]||1e4}},{key:"_poll",value:function(){var t=this;this.pollingTimeout=setTimeout((function(){t._connectionIsStale()?t._reconnect():t._poll()}),1e4)}},{key:"_startPolling",value:function(){clearTimeout(this.pollingTimeout),this._poll()}},{key:"_handlePing",value:function(){this.lastPing=C()}},{key:"_reset",value:function(){clearTimeout(this.reconnectTimeout),this.reconnectTries=0,this.attemptReconnect=!0,this._startPolling()}},{key:"connect",value:function(t){var e=this;this.params=t;var n={location:window.location.hostname,port:window.location.port,protocol:"https:"===window.location.protocol?"wss:":"ws:"};return t&&Object.assign(n,t),n.port&&(n.location+=":".concat(n.port)),new Promise((function(t,c){e.ws=new WebSocket("".concat(n.protocol,"//").concat(n.location).concat(e.endpoint)),e.ws.onmessage=function(t){e.handleMessage(t)},e.ws.onclose=function(){e.attemptReconnect&&e._reconnect()},e.ws.onopen=function(){e._reset(),t()}}))}},{key:"disconnect",value:function(){this.attemptReconnect=!1,clearTimeout(this.pollingTimeout),clearTimeout(this.reconnectTimeout),this.ws.close()}},{key:"channel",value:function(t){var e=new w(t,this);return this.channels.push(e),e}},{key:"handleMessage",value:function(t){if("ping"===t.data)return this._handlePing();var e=JSON.parse(t.data);this.channels.forEach((function(t){t.topic===e.topic&&t.handleMessage(e)}))}}]),t}();document.addEventListener("DOMContentLoaded",(function(){for(var t=document.querySelectorAll("a[data-method='delete']"),e=function(e){t[e].addEventListener("click",(function(n){n.preventDefault();var c=t[e].getAttribute("data-confirm")||"Are you sure?";if(confirm(c)){var a=document.createElement("form"),r=document.createElement("input");a.setAttribute("action",t[e].getAttribute("href")),a.setAttribute("method","POST"),r.setAttribute("type","hidden"),r.setAttribute("name","_method"),r.setAttribute("value","DELETE"),a.appendChild(r),document.body.appendChild(a),a.submit()}return!1}))},n=0;n<t.length;n++)e(n)})),Date.prototype.toGranite||function(){function t(t){return t<10?"0"+t:t}Date.prototype.toGranite=function(){return this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+" "+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())}}();var k=function(){var t=Object(u.g)().params,e=Object(u.f)(),n=Object(a.useState)({players:[]}),c=Object(m.a)(n,2),r=c[0],i=c[1],s=Object(a.useState)(0),o=Object(m.a)(s,2),f=o[0],b=o[1],v=Object(d.useToasts)().addToast;return Object(a.useEffect)((function(){Object(p.a)(l.a.mark((function n(){var c,a;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,h.a.get("/room/".concat(t.id));case 3:c=n.sent,a=c.data,i(a),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),401===n.t0.response.status&&e.push("/join-room/".concat(t.id));case 11:case"end":return n.stop()}}),n,null,[[0,8]])})))()}),[f]),Object(a.useEffect)((function(){var e=new D("/cuarenta/api/state");e.connect().then((function(){var n=e.channel("cuarenta_room:".concat(t.id));n.join(),n.on("message_new",(function(){b(e+1)}))}))}),[]),Object(j.jsx)("main",{children:Object(j.jsxs)("form",{children:[Object(j.jsxs)("div",{id:"room-id",children:["Room #",t.id]}),Object(j.jsx)("p",{id:"invite-text",children:"You can invite others by sharing the link of this page"}),Object(j.jsx)("div",{id:"player-names",children:r.players.map((function(t,e){return Object(j.jsx)("div",{className:"player-name",children:t.name},e)}))}),Object(j.jsx)("button",{type:"button",className:"blue-button down",onClick:T(e,t.id,r,v),children:"Play"}),Object(j.jsx)("button",{type:"button",className:"blue-button",children:"Leave"})]})})},T=function(t,e,n,c){return function(){2==n.players.length||4==n.players.length?t.push("/play/".concat(e)):c("There must be 2 or 4 players",{appearance:"error",autoDismiss:!0})}},H=function(){var t=Object(u.f)(),e=Object(u.g)().params,n=Object(a.useState)(""),c=Object(m.a)(n,2),r=c[0],i=c[1];return Object(a.useEffect)((function(){h.a.get("/").then((function(t){var e=t.data;i(e.name)}))}),[]),Object(j.jsx)("main",{children:Object(j.jsxs)("form",{children:[Object(j.jsx)("input",{type:"text",placeholder:"Enter a name",value:r,onChange:function(t){return i(t.target.value)},required:!0}),Object(j.jsx)("br",{}),Object(j.jsxs)("button",{type:"button",className:"blue-button",onClick:A(t,r,e.id),children:["Join room #",e.id]})]})})},A=function(t,e,n){return Object(p.a)(l.a.mark((function c(){var a,r,i;return l.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return(a=new FormData).set("username",e),c.next=4,h.a.post("/join-room/".concat(n),a);case 4:r=c.sent,i=r.data,t.push("/room/".concat(i.room_id));case 7:case"end":return c.stop()}}),c)})))},E=n(19),P=n.p+"static/media/10C.ca0996ab.svg",J=n.p+"static/media/10D.2f1fc168.svg",N=n.p+"static/media/10H.bedaae79.svg",M=n.p+"static/media/10S.c50751e2.svg",L=n.p+"static/media/2C.47915b3c.svg",R=n.p+"static/media/2D.1c975640.svg",U=n.p+"static/media/2H.bb3f5ea9.svg",I=n.p+"static/media/2S.f007f6fd.svg",K=n.p+"static/media/3C.11ef8837.svg",Q=n.p+"static/media/3D.de421c6c.svg",F=n.p+"static/media/3H.e877ee52.svg",z=n.p+"static/media/3S.323e2171.svg",q=n.p+"static/media/4C.df3c1d7d.svg",B=n.p+"static/media/4D.b0adcfd2.svg",G=n.p+"static/media/4H.c01f6d50.svg",W=n.p+"static/media/4S.d20f14a9.svg",Y=n.p+"static/media/5C.f6f85820.svg",V=n.p+"static/media/5D.b3553ee5.svg",X=n.p+"static/media/5H.9ba68654.svg",Z=n.p+"static/media/5S.9d718b3e.svg",$=n.p+"static/media/6C.9bdaddb8.svg",tt=n.p+"static/media/6D.0bd8541b.svg",et=n.p+"static/media/6H.6d245a5a.svg",nt=n.p+"static/media/6S.cec37dc9.svg",ct=n.p+"static/media/7C.c255ee4f.svg",at=n.p+"static/media/7D.31fc92f7.svg",rt=n.p+"static/media/7H.5063fce3.svg",it=n.p+"static/media/7S.12b4f48a.svg",st=n.p+"static/media/8C.903dd16c.svg",ot=n.p+"static/media/8D.930c615a.svg",ut=n.p+"static/media/8H.d5968a9e.svg",dt=n.p+"static/media/8S.77723fd3.svg",ft=n.p+"static/media/9C.f09638a9.svg",lt=n.p+"static/media/9D.0d6db1b1.svg",pt=n.p+"static/media/9H.41046ebd.svg",mt=n.p+"static/media/9S.2e0e0e86.svg",bt=n.p+"static/media/AC.034e45f3.svg",ht=n.p+"static/media/AD.9255198c.svg",jt=n.p+"static/media/AH.f746dd96.svg",vt=n.p+"static/media/AS.9c74e60e.svg",gt=n.p+"static/media/JC.082bc2b0.svg",Ot=n.p+"static/media/JD.eabe6031.svg",_t=n.p+"static/media/JH.dd9b1fd4.svg",xt=n.p+"static/media/JS.4c0c6359.svg",St=n.p+"static/media/KC.91ba7481.svg",yt=n.p+"static/media/KD.0d4d040e.svg",Ct=n.p+"static/media/KH.961f1abb.svg",wt=n.p+"static/media/KS.a20d2623.svg",Dt=n.p+"static/media/QC.c51b2716.svg",kt=n.p+"static/media/QD.e5d856cb.svg",Tt=n.p+"static/media/QH.a4065fb2.svg",Ht=n.p+"static/media/QS.b4b02a0c.svg",At=n(29),Et={S:"\u2660",C:"\u2663",H:"\u2665",D:"\u2666"},Pt=0,Jt=function(){var t=Object(u.g)().params,e=Object(d.useToasts)().addToast,n=Object(a.useState)(0),r=Object(m.a)(n,2),i=(r[0],r[1]),s=Object(a.useState)(null),o=Object(m.a)(s,2),f=o[0],l=o[1],p=Object(a.useState)(new At.a),b=Object(m.a)(p,2),v=b[0],g=b[1],O=Object(a.useState)({room:{players:[],board:[]},user:{hand:[]}}),_=Object(m.a)(O,2),x=_[0],S=_[1];return Object(a.useEffect)((function(){h.a.get("/play/".concat(t.id)).then((function(t){var e=t.data;S(e)}))}),[Pt]),Object(a.useEffect)((function(){var e=new D("/cuarenta/api/state");e.connect().then((function(){var n=e.channel("cuarenta_room:".concat(t.id));n.join(),n.on("message_new",(function(){i(++Pt)}))}))}),[]),Object(j.jsxs)("main",{children:[Object(j.jsxs)("div",{id:"control",children:[Object(j.jsxs)("div",{id:"players",children:[Object(j.jsxs)("div",{class:"player legend",children:[Object(j.jsx)("br",{}),"POINTS",Object(j.jsx)("br",{}),"CARDS"]}),x.room.players.map((function(t){return Object(j.jsxs)("div",{className:t.id==x.room.current_player.id?"current player":"player",children:[Object(j.jsx)("div",{children:t.name}),Object(j.jsxs)("div",{children:[Object(j.jsx)("div",{children:t.points}),Object(j.jsx)("div",{children:t.card_points})]})]})}))]}),Object(j.jsx)("button",{id:"action",className:Rt(f,v),onClick:Mt(f,v,t.id,e,l,x.room.board,g),children:Lt(f,v)})]}),Object(j.jsxs)("div",{className:"form",children:[Object(j.jsx)("div",{id:"board",children:x.room.board.map((function(t){return Object(j.jsx)("img",{src:c["card_".concat(t.name)],className:v.has(t.name)?"selected":"",onClick:function(){return g(Nt(v,t.name))}})}))}),Object(j.jsx)("div",{id:"hand",children:x.user.hand.map((function(t){return Object(j.jsx)("img",{src:c["card_".concat(t.name)],className:f&&f.name===t.name?"selected":"",onClick:function(){return l(t)}})}))})]})]})},Nt=function(t,e){return t.has(e)?t.delete(e):t.add(e)},Mt=function(t,e,n,c,a,r,i){return Object(p.a)(l.a.mark((function s(){var o,u;return l.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return o=t?"sum":e.size?"claim":"pass",u={action:o,hand:t,board:Object(E.a)(e).map((function(t){return r.find((function(e){return e.name==t}))}))},s.prev=2,s.next=5,h.a.post("/turn/".concat(n),u);case 5:s.next=11;break;case 8:s.prev=8,s.t0=s.catch(2),c(s.t0.response.data,{appearance:"error",autoDismiss:!0});case 11:i(new At.a),a(null);case 13:case"end":return s.stop()}}),s,null,[[2,8]])})))},Lt=function(t,e){return t?e.size?"SUM "+[t.name].concat(Object(E.a)(e)).join(" + ").replace(/[SCHD]/g,(function(t){return Et[t]})):"THROW "+t.name.replace(/[SCHD]/g,(function(t){return Et[t]})):e.size?"CLAIM "+Object(E.a)(e).join(", ").replace(/[SCHD]/g,(function(t){return Et[t]})):"PASS"},Rt=function(t,e){return t||e.size?"":"disabled"};h.a.defaults.baseURL="/cuarenta/api",h.a.defaults.withCredentials=!0;var Ut=function(){return Object(j.jsx)(o.a,{basename:"/cuarenta",children:Object(j.jsx)(d.ToastProvider,{children:Object(j.jsx)("div",{children:Object(j.jsxs)(u.c,{children:[Object(j.jsx)(u.a,{path:"/room/:id",children:Object(j.jsx)(k,{})}),Object(j.jsx)(u.a,{path:"/join-room/:id",children:Object(j.jsx)(H,{})}),Object(j.jsx)(u.a,{path:"/play/:id",children:Object(j.jsx)(Jt,{})}),Object(j.jsx)(u.a,{path:"/",children:Object(j.jsx)(v,{})})]})})})})},It=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,81)).then((function(e){var n=e.getCLS,c=e.getFID,a=e.getFCP,r=e.getLCP,i=e.getTTFB;n(t),c(t),a(t),r(t),i(t)}))};s.a.render(Object(j.jsx)(r.a.StrictMode,{children:Object(j.jsx)(Ut,{})}),document.getElementById("root")),It()}},[[80,1,2]]]);
//# sourceMappingURL=main.fda213c1.chunk.js.map